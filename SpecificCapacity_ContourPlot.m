% SpecificCapacity_ContourPlot.m provides an application example of the % analytical model described in:%      "A Quantitative Analytical Model for Predicting and Optimizing the %      Rate Performance of Battery Cells", Fan Wang and Ming Tang,%      arXiv:2004.10707 (2020)%% The Matlab script is used to generate Figure 6a and 6b in the above% paper, which are contour plots of the specific capacity of NMC half cells% and NMC/Graphite full cells as a function of cathode thickness and% porosity. % % Attention: The script contains a local function ('SpecificCapacity'), %            which is permissible only in MATLAB R2016b or later versions.%            To run the script in an earlier version of MATLAB, move the%            local function to a separate .m file. %% Created by: Fan Wang and Ming Tang %             Department of Materials Science & NanoEngineering %             Rice University, Houston, TX, USA% Contact: mingtang@rice.edu% Date: 08/04/2020%%% Define cell parameters assuming that cathode is NMC and anode is either Li metal or graphiteparam = NMC_Graphite_CellParameters();% Define the range of cathode thickness (Lc) and porosity (epsc) for contour plotsLc_space = linspace(50e-6, 400e-6, 1000);  % cathode thickness range (unit: m)epsc_space = linspace(0.15, 0.6, 1000); % cathode porosity range[Lc, epsc] = meshgrid(Lc_space, epsc_space);% Define discharge C rate and current densityC = 1; % discharge C rate I = param.F*(param.csmaxc-param.cs0c).*(1-epsc).*Lc.*C./3600;  % discharge current density (A/m^2)%% Contour plot of the specific capacity of NMC half cells at 1C discharge in the (Lc, epsc) space% Calculuate normalized discharge capacity at the given discharge rateDoDf = PredictDischargeCapacity_AnalyticalModel('UR', 'Li', param, I, Lc, epsc);% Calculate cell-level specific capacity for NMC half cellsQw = SpecificCapacity('HalfCell', param, DoDf, Lc, epsc);% Make plotfigurecontourf(Lc/1e-6,epsc,Qw,(0:5:120),'LineWidth',0.5,'LineColor',[0.6,0.6,0.6])caxis([0 120])colorbarset(gcf, 'Units', 'Inches', 'Position', [0 0 6 5.3])set(gca, 'Units', 'Inches', 'Position', [1.25 1 3.5 3.7])set(gca, 'FontName', 'Arial')set(gca, 'FontSize', 18)set(get(colorbar,'Title'),'String','{\it Q_{W}} (mAh/g)','FontSize',18)xlabel('{\it L_{cat}} (\mum)', 'FontSize', 24)ylabel('{\it \epsilon_{cat}}', 'FontSize', 24)%% Contour plot of the specific capacity of NMC/Graphite full cells at 1C discharge in the (Lc, epsc) space% Anode thickness is fixed at 1.15 times of cathode thicknessLa = 1.15*Lc;% Anode porosity is adjusted to fix the anode/cathode capacity ratio at 1.18epsa = 1-(1-epsc)/75*67;% Calculuate normalized discharge capacity at the given discharge rateDoDf = PredictDischargeCapacity_AnalyticalModel('UR', 'UR', param, I, Lc, epsc, La, epsa);% Calculate cell-level specific capacity for NMC/Graphite full cellsQw = SpecificCapacity('FullCell', param, DoDf, Lc, epsc, La, epsa);% Make plotfigurecontourf(Lc/1e-6,epsc,Qw,(0:5:80),'LineWidth',0.5,'LineColor',[0.6,0.6,0.6])caxis([0 80])colorbarset(gcf, 'Units', 'Inches', 'Position', [0 0 6 5.3])set(gca, 'Units', 'Inches', 'Position', [1.25 1 3.5 3.7])set(gca, 'FontName', 'Arial')set(gca, 'FontSize', 18)set(get(colorbar,'Title'),'String','{\it Q_{W}} (mAh/g)','FontSize',18)xlabel('{\it L_{cat}} (\mum)', 'FontSize', 24)ylabel('{\it \epsilon_{cat}}', 'FontSize', 24)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% local function%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%function Qw = SpecificCapacity(CellConfig, param, DoDf, Lc, epsc, La, epsa)%% Qw = SpecificCapacity(CellConfig, param, DoDf, Lc, epsc)%   or % Qw = SpecificCapacity(CellConfig, param, DoDf, Lc, epsc, La, epsa)% calculates the cell-level specific capacity.%% Inputs:%     CellConfig  - Cell configuration: 'HalfCell' (Li metal anode)%                         or 'FullCell' %     param       - Matlab structure array containing cell parameters%                   See 'NMC_Graphite_CellParameters.m' for an example.%     DoDf        - Normalized discharge capacity%     Lc          - Cathode thickness (unit: m)%     epsc        - Cathode porosity%     La          - Anode thickness (unit: m). Optional input used when%                   Cellconfig == 'FullCell'%     epsa        - Anode porosity. Optional input used when%                   Cellconfig == 'FullCell'% Read cell parameters Ls = param.Ls;epss = param.epss;rho_AMc = param.rho_AMc;rho_AMa = param.rho_AMa;rho_Li = param.rho_Li;rho_sep = param.rho_sep;rho_CCc = param.rho_CCc;rho_CCa = param.rho_CCa;L_CCc = param.L_CCc;L_CCa = param.L_CCa;rho_electrolyte = param.rho_electrolyte;Qv0c = param.F*(param.csmaxc-param.cs0c); % Intrisinc volmetric capacity of cathode active material (C/m^3)rho_cat = (1-epsc).*rho_AMc+epsc.*rho_electrolyte; % Average cathode density (g/cm^3) including electrolyterho_sep = (1-epss).*rho_sep+epss.*rho_electrolyte; % Average separator density (g/cm^3) including electrolyteswitch CellConfig    case 'HalfCell'        rho_an = rho_Li; % Li anode density (g/cm^3)        Qv0a = 2061.94*3.6e6; % Volmetric capacity of lithium (C/m^3)        La = 0.25*(1-epsc).*Qv0c./Qv0a.*Lc; % Assume Li anode thickness in fully discharged state provides 25% excess capacity     case 'FullCell'        if nargin < 7             error('Not enough inputs');        end        rho_an = (1-epsa).*rho_AMa+epsa.*rho_electrolyte; % Average anode density (g/cm^3) including electrolyte    otherwise        error 'Unrecognized cell configuration'end% Weight percentage of cathode active material in cell W = (rho_AMc*(1-epsc).*Lc)./(rho_cat.*Lc+rho_an.*La+rho_sep.*Ls+rho_CCc.*L_CCc+rho_CCa.*L_CCa);% Cell-level specific capacity (mAh/g) at the given disharge rate Qw = W.*Qv0c/3.6/rho_AMc/1e6.*DoDf;end